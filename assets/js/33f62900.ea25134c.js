"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1469],{3905:(e,t,r)=>{r.r(t),r.d(t,{MDXContext:()=>c,MDXProvider:()=>m,mdx:()=>f,useMDXComponents:()=>u,withMDXComponents:()=>p});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=n.createContext({}),p=function(e){return function(t){var r=u(t.components);return n.createElement(e,a({},t,{components:r}))}},u=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},m=function(e){var t=u(e.components);return n.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(r),m=o,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function f(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=h;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var c=2;c<a;c++)l[c]=r[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},85162:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var n=r(67294),o=r(86010);const a="tabItem_Ymn6";function l(e){let{children:t,hidden:r,className:l}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.default)(a,l),hidden:r},t)}},65488:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var n=r(83117),o=r(67294),a=r(86010),l=r(72389),i=r(67392),s=r(7094),c=r(12466);const p="tabList__CuJ",u="tabItem_LNqP";function m(e){var t,r;const{lazy:l,block:m,defaultValue:d,values:h,groupId:f,className:v}=e,b=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),y=null!=h?h:b.map((e=>{let{props:{value:t,label:r,attributes:n}}=e;return{value:t,label:r,attributes:n}})),x=(0,i.l)(y,((e,t)=>e.value===t.value));if(x.length>0)throw new Error('Docusaurus error: Duplicate values "'+x.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const g=null===d?d:null!=(t=null!=d?d:null==(r=b.find((e=>e.props.default)))?void 0:r.props.value)?t:b[0].props.value;if(null!==g&&!y.some((e=>e.value===g)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+g+'" but none of its children has the corresponding value. Available values are: '+y.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:w,setTabGroupChoices:N}=(0,s.U)(),[_,P]=(0,o.useState)(g),T=[],{blockElementScrollPositionUntilNextRender:k}=(0,c.o5)();if(null!=f){const e=w[f];null!=e&&e!==_&&y.some((t=>t.value===e))&&P(e)}const O=e=>{const t=e.currentTarget,r=T.indexOf(t),n=y[r].value;n!==_&&(k(t),P(n),null!=f&&N(f,String(n)))},C=e=>{var t;let r=null;switch(e.key){case"ArrowRight":{var n;const t=T.indexOf(e.currentTarget)+1;r=null!=(n=T[t])?n:T[0];break}case"ArrowLeft":{var o;const t=T.indexOf(e.currentTarget)-1;r=null!=(o=T[t])?o:T[T.length-1];break}}null==(t=r)||t.focus()};return o.createElement("div",{className:(0,a.default)("tabs-container",p)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.default)("tabs",{"tabs--block":m},v)},y.map((e=>{let{value:t,label:r,attributes:l}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:_===t?0:-1,"aria-selected":_===t,key:t,ref:e=>T.push(e),onKeyDown:C,onFocus:O,onClick:O},l,{className:(0,a.default)("tabs__item",u,null==l?void 0:l.className,{"tabs__item--active":_===t})}),null!=r?r:t)}))),l?(0,o.cloneElement)(b.filter((e=>e.props.value===_))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},b.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==_})))))}function d(e){const t=(0,l.default)();return o.createElement(m,(0,n.Z)({key:String(t)},e))}},43868:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(67294);const o="surveyLinkBox_bC1w";function a(e){let{docTitle:t}=e;return n.createElement("a",{href:"https://github.com/facebookresearch/playtorch/issues/new?assignees=&labels=Tutorial+Feedback&template=tutorial_feedback.yml",target:"_blank"},n.createElement("div",{className:o},"Share what we can improve!"))}},42522:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var n=r(83117),o=(r(67294),r(3905)),a=(r(65488),r(85162),r(43868));const l={id:"prepare-custom-model",sidebar_position:4,title:"Prepare Custom Model"},i=void 0,s={unversionedId:"tutorials/prepare-custom-model",id:"tutorials/prepare-custom-model",title:"Prepare Custom Model",description:"In this tutorial, we will learn how to prepare a custom PyTorch model to integrate it in a PlayTorch demo.",source:"@site/docs/tutorials/prepare-custom-model.mdx",sourceDirName:"tutorials",slug:"/tutorials/prepare-custom-model",permalink:"/docs/next/tutorials/prepare-custom-model",draft:!1,editUrl:"https://github.com/facebookresearch/playtorch/edit/main/website/docs/tutorials/prepare-custom-model.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"prepare-custom-model",sidebar_position:4,title:"Prepare Custom Model"},sidebar:"docs",previous:{title:"ML Powered French Translator",permalink:"/docs/next/tutorials/snacks/seq2seq-nmt"},next:{title:"Frequently Asked Questions",permalink:"/docs/next/tutorials/faq"}},c={},p=[{value:"Give us feedback",id:"give-us-feedback",level:2}],u={toc:p};function m(e){let{components:t,...r}=e;return(0,o.mdx)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("p",null,"In this tutorial, we will learn how to prepare a custom PyTorch model to integrate it in a PlayTorch demo."),(0,o.mdx)("p",null,"This section will guide you step-by-step for how to export a ",(0,o.mdx)("a",{parentName:"p",href:"https://pytorch.org/docs/stable/generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule"},"ScriptModule")," with model weights for the PyTorch Mobile Lite Interpreter runtime, which is used by PlayTorch to run inference with ML models. As an example, we will export the MobileNet V3 (small) model."),(0,o.mdx)("h1",{id:"set-up-python-virtual-environment"},"Set up Python virtual environment"),(0,o.mdx)("p",null,"It is recommended to run the Python scripts in a virtual environment. Python offers a command to create a virtual environment with the following command."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-shell"},"python3 -m venv venv\nsource venv/bin/activate\n")),(0,o.mdx)("h1",{id:"install-torch-and-torchvision-dependencies"},"Install ",(0,o.mdx)("inlineCode",{parentName:"h1"},"torch")," and ",(0,o.mdx)("inlineCode",{parentName:"h1"},"torchvision")," dependencies"),(0,o.mdx)("p",null,"The Python script requires ",(0,o.mdx)("inlineCode",{parentName:"p"},"torch")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"torchvision"),". Use the Python package manager (",(0,o.mdx)("inlineCode",{parentName:"p"},"pip3")," or simply ",(0,o.mdx)("inlineCode",{parentName:"p"},"pip")," in a virtual environment) to install both dependencies."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-shell"},"pip3 install torch torchvision\n")),(0,o.mdx)("h1",{id:"export-the-mobilenet-v3-model"},"Export the MobileNet V3 Model"),(0,o.mdx)("p",null,"The following script will download the MobileNet V3 model from the PyTorch Hub, optimize it for mobile use, and save it in a ",(0,o.mdx)("inlineCode",{parentName:"p"},"ptl")," format file (for PyTorch Mobile Lite Interpreter runtime)."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-py",metastring:"title=export_model.py",title:"export_model.py"},'import torch\nimport torchvision\nfrom torch.utils.mobile_optimizer import optimize_for_mobile\n\nmodel = torchvision.models.mobilenet_v3_small(pretrained=True)\nmodel.eval()\n\nscripted_model = torch.jit.script(model)\noptimized_model = optimize_for_mobile(scripted_model)\noptimized_model._save_for_lite_interpreter("mobilenet_v3_small.ptl")\n\nprint("model successfully exported")\n')),(0,o.mdx)("p",null,"Create the ",(0,o.mdx)("inlineCode",{parentName:"p"},"export_model.py")," file, add the Python script above, and then run Python script to create ",(0,o.mdx)("inlineCode",{parentName:"p"},"mobilenet_v3_small.ptl"),"."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-shell"},"python3 export_model.py\n")),(0,o.mdx)("p",null,"The script will create a file ",(0,o.mdx)("inlineCode",{parentName:"p"},"mobilenet_v3_small.ptl"),". Upload the ",(0,o.mdx)("inlineCode",{parentName:"p"},"mobilenet_v3_small.ptl")," file to a server that's publicly accessible, and then head over to the ",(0,o.mdx)("a",{parentName:"p",href:"/docs/next/tutorials/snacks/image-classification"},"image classification tutorial")," to see how you can use it with PlayTorch."),(0,o.mdx)("h2",{id:"give-us-feedback"},"Give us feedback"),(0,o.mdx)(a.Z,{docTitle:"Prepare Custom Model",mdxType:"SurveyLinkButton"}))}m.isMDXComponent=!0}}]);